# 一、堆是什麼？

- 堆是一个完全二叉树；
- 堆中每个节点的值都大于等于（或者小于等于）其左右子节点的值；
- 对于每个节点的值都大于等于子树中每个节点值的堆，叫做“大顶堆”。
- 对于每个节点的值都小于等于子树中每个节点值的堆，叫做“小顶堆”。
- ![image-20210409200241979](C:\Users\ZXY\AppData\Roaming\Typora\typora-user-images\image-20210409200241979.png)

# 二、怎么实现一个堆？

堆是可以用完全二叉树实现，完全二叉树可以用数组进行存储，节省空间。

对于i位置的节点，左子节点的索引就是2 * i；右子节点的索引是2 * i + 1；父节点的索引是i / 2。

![image-20210409200656782](C:\Users\ZXY\AppData\Roaming\Typora\typora-user-images\image-20210409200656782.png)

# 三、往堆中插入元素

把新元素放在堆的最后，然后逐渐往上进行对比、交换。

对于大顶堆来说，让新插入的节点与父节点对比大小。如果子节点>父节点，就交换两个节点。一直往上比较，直到子节点<父节点。

# 四、弹出堆顶元素

弹出堆顶元素后，把最后一个节点放到堆顶，然后利用同样的父子节点对比方法，这次是从上到下。由于是父节点一步一步往下交换，所以父节点要比较的是子节点中较大的那一个。

# 五、堆排序

## 1、建堆

这一步可以像往堆中插入元素一样，先假设堆中只有一个元素，然后依次插入所有的元素。

## 2、排序

建堆的时候我们要建成大顶堆，我们就有最大值了，这时我们把最大值和最后一个元素交换位置，然后将前n-1个元素再建堆，依次这样处理，就排好序了。

# 六、堆的应用

## 1、优先级队列

队列是先进先出，但是优先级队列是优先级高的先出。

优先级队列很适合用堆来实现，每次插入一个元素都根据优先级建堆，堆顶元素一定是优先级最高的。弹出优先级最高的元素就就可以直接弹出堆顶元素就可以了。

## 2、求topK元素。

①对于静态数据

维护一个大小为 K 的小顶堆，顺序遍历数组，从数组中取出数据与堆顶元素比较。如果比堆顶元素大，我们就把堆顶元素删除，并且将这个元素插入到堆中；如果比堆顶元素小，则不做处理，继续遍历数组。

②对于动态元素：一个数据集合中有两个操作：添加数据；查看当前的前 K 大数据。

可以一直都维护一个 K 大小的小顶堆，当有数据被添加到集合中时，就拿它与堆顶的元素对比。如果比堆顶元素大，就把堆顶元素删除，并且将这个元素插入到堆中；如果比堆顶元素小，则不做处理。

这样，无论任何时候需要查询当前的前 K 大数据，都可以立刻返回给他。(其实与静态数据维护一样)

## 3、求中位数

**注：奇数就是求第n/2+1的那个数；偶数就是求第n/2和n/2+1两个数中的任意一个**

维护两个堆，1个大顶堆、1个小顶堆，大顶堆中存储前半部分数据，小顶堆中存储后半部分数据，且小顶堆中的数据都大于大顶堆中的数据。

如果有 n 个数据，n 是偶数，我们从小到大排序，那前 n/2 个数据存储在大顶堆中，后 n/2 个数据存储在小顶堆中。这样，大顶堆中的堆顶元素就是我们要找的中位数。如果 n 是奇数，情况是类似的，大顶堆就存储 n/2+1 个数据，小顶堆中就存储 n/2 个数据。

插入一个元素时，如果该元素小于等于大顶堆的堆顶元素，我们就将这个新数据插入到大顶堆；否则，我们就将这个新数据插入到小顶堆。

当两个堆的元素个数不满足要求时候，就需要将元素个数多的堆的元素转移到元素个数少的堆中。

利用同样的方法不仅可以求中位数，还可以求第99%的数，只要按比例定制两个堆的元素个数就可以。